{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\SidWonder\\\\Documents\\\\auth\\\\src\\\\components\\\\App.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport { Route, Switch, Redirect, BrowserRouter, useHistory } from 'react-router-dom';\nimport Header from './Header.js';\nimport { Main } from './Main.js';\nimport Footer from './Footer.js';\nimport PopupWithForm from './PopupWithForm';\nimport EditProfilePopup from './EditProfilePopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport ImagePopup from './ImagePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport '../index.css';\nimport api from '../utils/api';\nimport * as auth from '../utils/auth';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoTooltip from './InfoTooltip';\nimport ProtectedRoute from './ProtectedRoute';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [isEditAvatarPopupOpen, setAvatarPopupOpen] = React.useState(false);\n  const [isEditProfilePopupOpen, setPopupProfileState] = React.useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [isLoggedIn, setLogged] = React.useState(Boolean(localStorage.getItem('token')));\n  const [userInfo, setUserInfo] = React.useState({});\n  const [registerIsOk, setRegisterIsOk] = React.useState(false);\n  const [showInfoTooltip, setShowInfoTooltip] = React.useState(false);\n  const history = useHistory();\n  React.useEffect(() => {\n    async function fetchData() {\n      const userInfo = await api.getUserInfo();\n      return userInfo;\n    }\n\n    fetchData().then(data => setCurrentUser(data)).catch(err => console.log(err));\n  }, []);\n  React.useEffect(() => {\n    async function fetchData() {\n      const cardsData = await api.getCards();\n      return cardsData;\n    }\n\n    fetchData().then(data => setCards(data)).catch(err => console.log(err));\n  }, []);\n\n  function tokenCheck() {\n    const token = localStorage.getItem('token');\n\n    if (!token) {\n      return;\n    }\n\n    auth.getUserData(token).then(res => {\n      if (res.status === 401) {\n        throw new Error('Токен не передан или передан не в том формате');\n      } else if (res.status === 400) {\n        throw new Error('Переданный токен некорректен');\n      } else {\n        return res.json();\n      }\n    }).then(res => {\n      console.log(res);\n      const data = res.data ? res.data : {};\n      setUserInfo(data);\n    });\n  }\n\n  React.useEffect(() => {\n    tokenCheck();\n\n    if (isLoggedIn) {\n      history.push('/');\n    }\n  }, [isLoggedIn]);\n\n  function handleEditAvatarClick() {\n    setAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setPopupProfileState(true);\n  }\n\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function handleCloseAll() {\n    setPopupProfileState(false);\n    setAvatarPopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setSelectedCard({});\n  }\n\n  function handleUpdateUser(userData) {\n    api.setUserInfo(userData).then(data => {\n      setCurrentUser(data);\n    }).catch(err => {\n      console.log(err);\n    });\n    handleCloseAll();\n  }\n\n  function handleUpdateAvatar(userData) {\n    console.log(userData);\n    api.setUserAvatar(userData).then(data => {\n      setCurrentUser(data);\n    }).catch(err => {\n      console.log(err);\n    });\n    handleCloseAll();\n  }\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    if (!isLiked) {\n      api.addLike(card).then(newCard => {\n        setCards(state => state.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => {\n        console.log(err);\n      });\n    } else {\n      api.deleteLike(card).then(newCard => {\n        setCards(state => state.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card).then(() => {\n      setCards(cards.filter(item => item._id !== card._id));\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  function handleAddPlace(placeData) {\n    api.addNewCard(placeData).then(data => {\n      setCards([data, ...cards]);\n    }).catch(err => {\n      console.log(err);\n    });\n    handleCloseAll();\n  }\n\n  function handleRegister(email, password) {\n    auth.register(email, password).then(res => {\n      if (res.status === 400) {\n        setRegisterIsOk(false);\n        setShowInfoTooltip(true);\n        throw new Error('некорректно заполнено одно из полей');\n      } else {\n        setRegisterIsOk(true);\n        setShowInfoTooltip(true);\n      }\n    }).catch(e => console.log(e));\n  }\n\n  const closeInfoTooltipSuccess = () => {\n    setShowInfoTooltip(false);\n    history.push('/sign-in');\n  };\n\n  const closeInfoTooltipFailure = () => {\n    setShowInfoTooltip(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page__content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page\",\n        children: [/*#__PURE__*/_jsxDEV(Header, {\n          isLoggedIn: isLoggedIn,\n          setLogged: setLogged,\n          userInfo: userInfo,\n          setUserInfo: setUserInfo\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(BrowserRouter, {\n          children: /*#__PURE__*/_jsxDEV(Switch, {\n            children: [/*#__PURE__*/_jsxDEV(Route, {\n              path: \"/sign-up\",\n              children: /*#__PURE__*/_jsxDEV(Register, {\n                handleRegister: handleRegister\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 186,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/sign-in\",\n              children: /*#__PURE__*/_jsxDEV(Login, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 190,\n                columnNumber: 9\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n              children: [\"path='/' component=\", Main, \"isLoggedIn=\", isLoggedIn, \"onEditAvatar=\", handleEditAvatarClick, \"onEditProfile=\", handleEditProfileClick, \"onAddPlace=\", handleAddPlaceClick, \"onCardClick=\", handleCardClick, \"cards=\", cards, \"onCardDelete=\", handleCardDelete, \"onCardLike=\", handleCardLike]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              children: isLoggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n                to: \"/\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 29\n              }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n                to: \"/sign-in\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 51\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 205,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        closeIt: handleCloseAll,\n        onUpdateUser: handleUpdateUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        closeIt: handleCloseAll,\n        onUpdateAvatar: handleUpdateAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        closeIt: handleCloseAll,\n        onUpdatePlace: handleAddPlace\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(PopupWithForm, {\n        name: \"popup-confirm\",\n        title: \"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",\n        buttonText: \"\\u0414\\u0430\",\n        isOpen: false,\n        closeIt: handleCloseAll\n        /* eslint-disable-next-line react/no-children-prop */\n        ,\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 5\n      }, this), selectedCard._id && /*#__PURE__*/_jsxDEV(ImagePopup, {\n        card: selectedCard,\n        closeIt: handleCloseAll\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 26\n      }, this), showInfoTooltip && /*#__PURE__*/_jsxDEV(InfoTooltip, {\n        onClose: registerIsOk ? closeInfoTooltipSuccess : closeInfoTooltipFailure,\n        isOk: registerIsOk\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 176,\n    columnNumber: 3\n  }, this);\n}\n\n_s(App, \"3qPB9NVYNXs/CQrc30Lat4jFlWU=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["C:/Users/SidWonder/Documents/auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","BrowserRouter","useHistory","Header","Main","Footer","PopupWithForm","EditProfilePopup","AddPlacePopup","ImagePopup","EditAvatarPopup","CurrentUserContext","api","auth","Register","Login","InfoTooltip","ProtectedRoute","App","isEditAvatarPopupOpen","setAvatarPopupOpen","useState","isEditProfilePopupOpen","setPopupProfileState","isAddPlacePopupOpen","setAddPlacePopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isLoggedIn","setLogged","Boolean","localStorage","getItem","userInfo","setUserInfo","registerIsOk","setRegisterIsOk","showInfoTooltip","setShowInfoTooltip","history","useEffect","fetchData","getUserInfo","then","data","catch","err","console","log","cardsData","getCards","tokenCheck","token","getUserData","res","status","Error","json","push","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleCloseAll","handleUpdateUser","userData","handleUpdateAvatar","setUserAvatar","handleCardLike","isLiked","likes","some","i","_id","addLike","newCard","state","map","c","deleteLike","handleCardDelete","deleteCard","filter","item","handleAddPlace","placeData","addNewCard","handleRegister","email","password","register","e","closeInfoTooltipSuccess","closeInfoTooltipFailure"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Route, Switch, Redirect, BrowserRouter, useHistory} from 'react-router-dom';\r\nimport Header from './Header.js';\r\nimport {Main} from './Main.js';\r\nimport Footer from './Footer.js';\r\nimport PopupWithForm from './PopupWithForm';\r\nimport EditProfilePopup from './EditProfilePopup';\r\nimport AddPlacePopup from './AddPlacePopup';\r\nimport ImagePopup from './ImagePopup';\r\nimport EditAvatarPopup from './EditAvatarPopup';\r\nimport {CurrentUserContext} from '../contexts/CurrentUserContext';\r\nimport '../index.css';\r\nimport api from '../utils/api';\r\nimport * as auth from '../utils/auth';\r\nimport Register from './Register';\r\nimport Login from './Login';\r\nimport InfoTooltip from './InfoTooltip';\r\nimport ProtectedRoute from './ProtectedRoute';\r\n\r\nfunction App() {\r\n\r\n\tconst [isEditAvatarPopupOpen, setAvatarPopupOpen] = React.useState(false);\r\n\tconst [isEditProfilePopupOpen, setPopupProfileState] = React.useState(false);\r\n\tconst [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false);\r\n\tconst [selectedCard, setSelectedCard] = React.useState({});\r\n\r\n\tconst [currentUser, setCurrentUser] = React.useState({});\r\n\tconst [cards, setCards] = React.useState([]);\r\n\r\n\tconst [isLoggedIn, setLogged] = React.useState(Boolean(localStorage.getItem('token')));\r\n\tconst [userInfo, setUserInfo] = React.useState({});\r\n\tconst [registerIsOk, setRegisterIsOk] = React.useState(false);\r\n\tconst [showInfoTooltip, setShowInfoTooltip] = React.useState(false);\r\n\tconst history = useHistory();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function fetchData() {\r\n\t\t\tconst userInfo = await api.getUserInfo();\r\n\t\t\treturn userInfo;\r\n\t\t}\r\n\t\tfetchData()\r\n\t\t\t.then(data=> setCurrentUser(data))\r\n\t\t\t.catch(err => console.log(err));\r\n\t}, []);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function fetchData() {\r\n\t\t\tconst cardsData = await api.getCards();\r\n\t\t\treturn cardsData;\r\n\t\t}\r\n\t\tfetchData()\r\n\t\t\t.then(data=> setCards(data))\r\n\t\t\t.catch(err => console.log(err));\r\n\t}, []);\r\n\r\n\tfunction tokenCheck() {\r\n\t\tconst token = localStorage.getItem('token');\r\n\t\tif (!token) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tauth.getUserData(token)\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res.status === 401) {\r\n\t\t\t\t\tthrow new Error('Токен не передан или передан не в том формате');\r\n\t\t\t\t} else if (res.status === 400) {\r\n\t\t\t\t\tthrow new Error('Переданный токен некорректен');\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn res.json();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t\tconst data = res.data ? res.data : {};\r\n\t\t\t\tsetUserInfo(data);\r\n\t\t\t});\r\n\t}\r\n\r\n\tReact.useEffect(() => {\r\n\t\ttokenCheck();\r\n\t\tif (isLoggedIn) {\r\n\t\t\thistory.push('/');\r\n\t\t}\r\n\t}, [isLoggedIn]);\r\n\r\n\tfunction handleEditAvatarClick() {\r\n\t\tsetAvatarPopupOpen(true);\r\n\t}\r\n\r\n\tfunction handleEditProfileClick() {\r\n\t\tsetPopupProfileState(true);\r\n\t}\r\n\r\n\tfunction handleAddPlaceClick() {\r\n\t\tsetAddPlacePopupOpen(true);\r\n\t}\r\n\r\n\tfunction handleCardClick(card) {\r\n\t\tsetSelectedCard(card);\r\n\t}\r\n\r\n\tfunction handleCloseAll() {\r\n\t\tsetPopupProfileState(false);\r\n\t\tsetAvatarPopupOpen(false);\r\n\t\tsetAddPlacePopupOpen(false);\r\n\t\tsetSelectedCard({});\r\n\t}\r\n\r\n\tfunction handleUpdateUser(userData) {\r\n\t\tapi.setUserInfo(userData).then((data) => {\r\n\t\t\tsetCurrentUser(data);\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t\thandleCloseAll();\r\n\t}\r\n\r\n\tfunction handleUpdateAvatar(userData) {\r\n\t\tconsole.log(userData);\r\n\t\tapi.setUserAvatar(userData).then((data) => {\r\n\t\t\tsetCurrentUser(data);\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t\thandleCloseAll();\r\n\t}\r\n\r\n\r\n\tfunction handleCardLike(card) {\r\n\t\t// Снова проверяем, есть ли уже лайк на этой карточке\r\n\t\tconst isLiked = card.likes.some(i => i._id === currentUser._id);\r\n\t\tif (!isLiked) {\r\n\t\t\tapi.addLike(card).then((newCard) => {\r\n\t\t\t\tsetCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n\t\t\t}).catch((err) => { console.log(err); });\r\n\t\t} else {\r\n\t\t\tapi.deleteLike(card).then((newCard) => {\r\n\t\t\t\tsetCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n\t\t\t}).catch((err) => { console.log(err); });\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleCardDelete(card) {\r\n\t\tapi.deleteCard(card).then(() => {\r\n\t\t\tsetCards(cards.filter((item) => item._id !== card._id));\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t}\r\n\r\n\tfunction handleAddPlace(placeData) {\r\n\t\tapi.addNewCard(placeData).then((data) => {\r\n\t\t\tsetCards([data, ...cards]);\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t\thandleCloseAll();\r\n\t}\r\n\r\n\tfunction handleRegister(email, password) {\r\n\t\tauth.register(email, password)\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res.status === 400) {\r\n\t\t\t\t\tsetRegisterIsOk(false);\r\n\t\t\t\t\tsetShowInfoTooltip(true);\r\n\t\t\t\t\tthrow new Error('некорректно заполнено одно из полей');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetRegisterIsOk(true);\r\n\t\t\t\t\tsetShowInfoTooltip(true);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch((e) => console.log(e));\r\n\t}\r\n\r\n\tconst closeInfoTooltipSuccess = () => {\r\n\t\tsetShowInfoTooltip(false);\r\n\t\thistory.push('/sign-in');\r\n\t};\r\n\r\n\tconst closeInfoTooltipFailure = () => {\r\n\t\tsetShowInfoTooltip(false);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={currentUser}>\r\n\t\t\t<div className=\"page__content\">\r\n\t\t\t\t<div className=\"page\">\r\n\t\t\t\t\t<Header \r\n\t\t\t\t\t\tisLoggedIn={isLoggedIn}\r\n\t\t\t\t\t\tsetLogged={setLogged}\r\n\t\t\t\t\t\tuserInfo={userInfo}\r\n\t\t\t\t\t\tsetUserInfo={setUserInfo}/>\r\n\t\t\t\t\t<BrowserRouter>\r\n\t\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t\t<Route path='/sign-up'>\r\n\t\t\t\t\t\t\t\t<Register handleRegister={handleRegister}/>\r\n\t\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t\t<Route path='/sign-in'>\r\n\t\t\t\t\t\t\t\t<Login/>\r\n\t\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t\t<ProtectedRoute>\r\n\t\t\t\t\t\t\t\t{/* eslint-disable-next-line react/no-unescaped-entities */}\r\n\t\t\t\t\t\t\t\tpath='/'\r\n\t\t\t\t\t\t\t\tcomponent={Main}\r\n\t\t\t\t\t\t\t\tisLoggedIn={isLoggedIn}\r\n\t\t\t\t\t\t\t\tonEditAvatar={handleEditAvatarClick}\r\n\t\t\t\t\t\t\t\tonEditProfile={handleEditProfileClick}\r\n\t\t\t\t\t\t\t\tonAddPlace={handleAddPlaceClick}\r\n\t\t\t\t\t\t\t\tonCardClick={handleCardClick}\r\n\t\t\t\t\t\t\t\tcards={cards}\r\n\t\t\t\t\t\t\t\tonCardDelete={handleCardDelete}\r\n\t\t\t\t\t\t\t\tonCardLike={handleCardLike}\r\n\t\t\t\t\t\t\t</ProtectedRoute>\r\n\t\t\t\t\t\t\t<Route>{isLoggedIn ? <Redirect to='/' /> : <Redirect to='/sign-in' />}</Route>\r\n\t\t\t\t\t\t</Switch>\r\n\t\t\t\t\t</BrowserRouter>\r\n\t\t\t\t\t<Footer/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<EditProfilePopup\r\n\t\t\t\t\tisOpen={isEditProfilePopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdateUser={handleUpdateUser}\r\n\t\t\t\t/>\r\n\t\t\t\t<EditAvatarPopup\r\n\t\t\t\t\tisOpen={isEditAvatarPopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdateAvatar={handleUpdateAvatar}\r\n\t\t\t\t/>\r\n\t\t\t\t<AddPlacePopup\r\n\t\t\t\t\tisOpen={isAddPlacePopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdatePlace={handleAddPlace}\r\n\t\t\t\t/>\r\n\t\t\t\t<PopupWithForm name='popup-confirm'\r\n\t\t\t\t\ttitle='Вы уверены?'\r\n\t\t\t\t\tbuttonText='Да'\r\n\t\t\t\t\tisOpen={false}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\t\t\t   /* eslint-disable-next-line react/no-children-prop */\r\n\t\t\t\t\tchildren={<>\r\n\t\t\t\t\t</>}\r\n\t\t\t\t/>\r\n\t\t\t\t{selectedCard._id && <ImagePopup card={selectedCard} closeIt={handleCloseAll}/>}\r\n\t\t\t\t{showInfoTooltip && (\r\n\t\t\t\t\t<InfoTooltip\r\n\t\t\t\t\t\tonClose={registerIsOk ? closeInfoTooltipSuccess : closeInfoTooltipFailure}\r\n\t\t\t\t\t\tisOk={registerIsOk}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</CurrentUserContext.Provider>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}