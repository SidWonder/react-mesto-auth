{"ast":null,"code":"import _toConsumableArray from\"C:/Users/SidWonder/Documents/auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/SidWonder/Documents/auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/SidWonder/Documents/auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/SidWonder/Documents/auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Route,Switch,Redirect,BrowserRouter,useHistory}from'react-router-dom';import Header from'./Header.js';import Main from'./Main.js';import Footer from'./Footer.js';import PopupWithForm from'./PopupWithForm';import EditProfilePopup from'./EditProfilePopup';import AddPlacePopup from'./AddPlacePopup';import ImagePopup from'./ImagePopup';import EditAvatarPopup from'./EditAvatarPopup';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/api';import*as auth from'../utils/auth';import Register from'./Register';import Login from'./Login';import InfoTooltip from'./InfoTooltip';import ProtectedRoute from'./ProtectedRoute';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setIsAvatarPopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setIsPopupProfileState=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setIsAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isImagePopupOpen=_React$useState8[0],setIsImagePopupOpen=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),selectedCard=_React$useState10[0],setSelectedCard=_React$useState10[1];var _React$useState11=React.useState({}),_React$useState12=_slicedToArray(_React$useState11,2),currentUser=_React$useState12[0],setCurrentUser=_React$useState12[1];var _React$useState13=React.useState([]),_React$useState14=_slicedToArray(_React$useState13,2),cards=_React$useState14[0],setCards=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isLoggedIn=_React$useState16[0],setIsLogged=_React$useState16[1];var _React$useState17=React.useState({}),_React$useState18=_slicedToArray(_React$useState17,2),userInfo=_React$useState18[0],setUserInfo=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),registerIsOk=_React$useState20[0],setRegisterIsOk=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),showInfoTooltip=_React$useState22[0],setShowInfoTooltip=_React$useState22[1];var history=useHistory();React.useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var userInfo;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return api.getUserInfo();case 2:userInfo=_context.sent;return _context.abrupt(\"return\",userInfo);case 4:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}fetchData().then(function(data){return setCurrentUser(data);}).catch(function(err){return console.log(err);});},[]);React.useEffect(function(){function fetchData(){return _fetchData2.apply(this,arguments);}function _fetchData2(){_fetchData2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var cardsData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return api.getCards();case 2:cardsData=_context2.sent;return _context2.abrupt(\"return\",cardsData);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return _fetchData2.apply(this,arguments);}fetchData().then(function(data){return setCards(data);}).catch(function(err){return console.log(err);});},[]);function tokenCheck(){var token=localStorage.getItem('token');if(!token){return;}auth.getUserData(token).then(function(res){if(res.status===401){throw new Error('Токен не передан или передан не в том формате');}else if(res.status===400){throw new Error('Переданный токен некорректен');}else{return res.json();}}).then(function(res){var data=res.data?res.data:{};setIsLogged(true);setUserInfo(data);}).catch(function(err){return console.log(err);});}React.useEffect(function(){tokenCheck();if(isLoggedIn){history.push('/');}},[isLoggedIn]);function handleEditAvatarClick(){setIsAvatarPopupOpen(true);}function handleEditProfileClick(){setIsPopupProfileState(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleCardClick(card){setIsImagePopupOpen(true);setSelectedCard(card);}function handleCloseAll(){setIsPopupProfileState(false);setIsAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setIsImagePopupOpen(false);setSelectedCard({});}function handleUpdateUser(userData){api.setUserInfo(userData).then(function(data){setCurrentUser(data);handleCloseAll();}).catch(function(err){console.log(err);});}function handleUpdateAvatar(userData){api.setUserAvatar(userData).then(function(data){setCurrentUser(data);handleCloseAll();}).catch(function(err){console.log(err);});}function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});if(!isLiked){api.addLike(card).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}else{api.deleteLike(card).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}}function handleCardDelete(card){api.deleteCard(card).then(function(){setCards(cards.filter(function(item){return item._id!==card._id;}));}).catch(function(err){console.log(err);});}function handleAddPlace(placeData){api.addNewCard(placeData).then(function(data){setCards([data].concat(_toConsumableArray(cards)));handleCloseAll();}).catch(function(err){console.log(err);});}function handleRegister(email,password){auth.register(email,password).then(function(res){if(res.status===400){setRegisterIsOk(false);setShowInfoTooltip(true);throw new Error('некорректно заполнено одно из полей');}else{setRegisterIsOk(true);setShowInfoTooltip(true);}}).catch(function(e){return console.log(e);});}function handleLogin(email,password){return auth.authorize(email,password).then(function(data){if(data.token){setIsLogged(true);localStorage.setItem('token',data.token);}else if(data.status===400){throw new Error('не передано одно из полей');}else if(data.status===401){throw new Error('пользователь с email не найден');}else{throw new Error('что-то пошло не так');}}).catch(function(err){return console.log(err);});}function handleSignOut(){localStorage.removeItem('token');history.push('/sign-in');setIsLogged(false);}var closeInfoTooltipSuccess=function closeInfoTooltipSuccess(){setShowInfoTooltip(false);history.push('/sign-in');};var closeInfoTooltipFailure=function closeInfoTooltipFailure(){setShowInfoTooltip(false);};return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page__content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{isLoggedIn:isLoggedIn,setLogged:setIsLogged,onSignOut:handleSignOut,userInfo:userInfo,setUserInfo:setUserInfo}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin,tokenCheck:tokenCheck})}),/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",isLoggedIn:isLoggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,cards:cards,onCardDelete:handleCardDelete,onCardLike:handleCardLike}),/*#__PURE__*/_jsx(Route,{children:isLoggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(Footer,{})]}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,closeIt:handleCloseAll,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,closeIt:handleCloseAll,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,closeIt:handleCloseAll,onUpdatePlace:handleAddPlace}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"popup-confirm\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",buttonText:\"\\u0414\\u0430\",isOpen:false,closeIt:handleCloseAll}),/*#__PURE__*/_jsx(ImagePopup,{isOpen:isImagePopupOpen,card:selectedCard,closeIt:handleCloseAll}),showInfoTooltip&&/*#__PURE__*/_jsx(InfoTooltip,{onClose:registerIsOk?closeInfoTooltipSuccess:closeInfoTooltipFailure,isOk:registerIsOk})]})});}export default App;","map":{"version":3,"sources":["C:/Users/SidWonder/Documents/auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","BrowserRouter","useHistory","Header","Main","Footer","PopupWithForm","EditProfilePopup","AddPlacePopup","ImagePopup","EditAvatarPopup","CurrentUserContext","api","auth","Register","Login","InfoTooltip","ProtectedRoute","App","useState","isEditAvatarPopupOpen","setIsAvatarPopupOpen","isEditProfilePopupOpen","setIsPopupProfileState","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isLoggedIn","setIsLogged","userInfo","setUserInfo","registerIsOk","setRegisterIsOk","showInfoTooltip","setShowInfoTooltip","history","useEffect","fetchData","getUserInfo","then","data","catch","err","console","log","getCards","cardsData","tokenCheck","token","localStorage","getItem","getUserData","res","status","Error","json","push","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleCloseAll","handleUpdateUser","userData","handleUpdateAvatar","setUserAvatar","handleCardLike","isLiked","likes","some","i","_id","addLike","newCard","state","map","c","deleteLike","handleCardDelete","deleteCard","filter","item","handleAddPlace","placeData","addNewCard","handleRegister","email","password","register","e","handleLogin","authorize","setItem","handleSignOut","removeItem","closeInfoTooltipSuccess","closeInfoTooltipFailure"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Route, Switch, Redirect, BrowserRouter, useHistory} from 'react-router-dom';\r\nimport Header from './Header.js';\r\nimport Main from './Main.js';\r\nimport Footer from './Footer.js';\r\nimport PopupWithForm from './PopupWithForm';\r\nimport EditProfilePopup from './EditProfilePopup';\r\nimport AddPlacePopup from './AddPlacePopup';\r\nimport ImagePopup from './ImagePopup';\r\nimport EditAvatarPopup from './EditAvatarPopup';\r\nimport {CurrentUserContext} from '../contexts/CurrentUserContext';\r\nimport api from '../utils/api';\r\nimport * as auth from '../utils/auth';\r\nimport Register from './Register';\r\nimport Login from './Login';\r\nimport InfoTooltip from './InfoTooltip';\r\nimport ProtectedRoute from './ProtectedRoute';\r\n\r\nfunction App() {\r\n\r\n\tconst [isEditAvatarPopupOpen, setIsAvatarPopupOpen] = React.useState(false);\r\n\tconst [isEditProfilePopupOpen, setIsPopupProfileState] = React.useState(false);\r\n\tconst [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\r\n\tconst [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\r\n\tconst [selectedCard, setSelectedCard] = React.useState({});\r\n\r\n\tconst [currentUser, setCurrentUser] = React.useState({});\r\n\tconst [cards, setCards] = React.useState([]);\r\n\r\n\tconst [isLoggedIn, setIsLogged] = React.useState(false);\r\n\tconst [userInfo, setUserInfo] = React.useState({});\r\n\tconst [registerIsOk, setRegisterIsOk] = React.useState(false);\r\n\tconst [showInfoTooltip, setShowInfoTooltip] = React.useState(false);\r\n\r\n\tconst history = useHistory();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function fetchData() {\r\n\t\t\tconst userInfo = await api.getUserInfo();\r\n\t\t\treturn userInfo;\r\n\t\t}\r\n\t\tfetchData()\r\n\t\t\t.then(data=> setCurrentUser(data))\r\n\t\t\t.catch(err => console.log(err));\r\n\t}, []);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function fetchData() {\r\n\t\t\tconst cardsData = await api.getCards();\r\n\t\t\treturn cardsData;\r\n\t\t}\r\n\t\tfetchData()\r\n\t\t\t.then(data=> setCards(data))\r\n\t\t\t.catch(err => console.log(err));\r\n\t}, []);\r\n\r\n\tfunction tokenCheck() {\r\n\t\tconst token = localStorage.getItem('token');\r\n\t\tif (!token) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tauth.getUserData(token)\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res.status === 401) {\r\n\t\t\t\t\tthrow new Error('Токен не передан или передан не в том формате');\r\n\t\t\t\t} else if (res.status === 400) {\r\n\t\t\t\t\tthrow new Error('Переданный токен некорректен');\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn res.json();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tconst data = res.data ? res.data : {};\r\n\t\t\t\tsetIsLogged(true);\r\n\t\t\t\tsetUserInfo(data);\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.log(err));\r\n\t}\r\n\r\n\tReact.useEffect(() => {\r\n\t\ttokenCheck();\r\n\t\tif (isLoggedIn) {\r\n\t\t\thistory.push('/');\r\n\t\t}\r\n\t}, [isLoggedIn]);\r\n\r\n\tfunction handleEditAvatarClick() {\r\n\t\tsetIsAvatarPopupOpen(true);\r\n\t}\r\n\r\n\tfunction handleEditProfileClick() {\r\n\t\tsetIsPopupProfileState(true);\r\n\t}\r\n\r\n\tfunction handleAddPlaceClick() {\r\n\t\tsetIsAddPlacePopupOpen(true);\r\n\t}\r\n\r\n\tfunction handleCardClick(card) {\r\n\t\tsetIsImagePopupOpen(true);\r\n\t\tsetSelectedCard(card);\r\n\t}\r\n\r\n\tfunction handleCloseAll() {\r\n\t\tsetIsPopupProfileState(false);\r\n\t\tsetIsAvatarPopupOpen(false);\r\n\t\tsetIsAddPlacePopupOpen(false);\r\n\t\tsetIsImagePopupOpen(false);\r\n\t\tsetSelectedCard({});\r\n\t}\r\n\r\n\tfunction handleUpdateUser(userData) {\r\n\t\tapi.setUserInfo(userData).then((data) => {\r\n\t\t\tsetCurrentUser(data);\r\n\t\t\thandleCloseAll();\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t}\r\n\r\n\tfunction handleUpdateAvatar(userData) {\r\n\t\tapi.setUserAvatar(userData).then((data) => {\r\n\t\t\tsetCurrentUser(data);\r\n\t\t\thandleCloseAll();\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t}\r\n\r\n\r\n\tfunction handleCardLike(card) {\r\n\t\t// Снова проверяем, есть ли уже лайк на этой карточке\r\n\t\tconst isLiked = card.likes.some(i => i._id === currentUser._id);\r\n\t\tif (!isLiked) {\r\n\t\t\tapi.addLike(card).then((newCard) => {\r\n\t\t\t\tsetCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n\t\t\t}).catch((err) => { console.log(err); });\r\n\t\t} else {\r\n\t\t\tapi.deleteLike(card).then((newCard) => {\r\n\t\t\t\tsetCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n\t\t\t}).catch((err) => { console.log(err); });\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleCardDelete(card) {\r\n\t\tapi.deleteCard(card).then(() => {\r\n\t\t\tsetCards(cards.filter((item) => item._id !== card._id));\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t}\r\n\r\n\tfunction handleAddPlace(placeData) {\r\n\t\tapi.addNewCard(placeData).then((data) => {\r\n\t\t\tsetCards([data, ...cards]);\r\n\t\t\thandleCloseAll();\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t}\r\n\r\n\tfunction handleRegister(email, password) {\r\n\t\tauth.register(email, password)\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res.status === 400) {\r\n\t\t\t\t\tsetRegisterIsOk(false);\r\n\t\t\t\t\tsetShowInfoTooltip(true);\r\n\t\t\t\t\tthrow new Error('некорректно заполнено одно из полей');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetRegisterIsOk(true);\r\n\t\t\t\t\tsetShowInfoTooltip(true);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch((e) => console.log(e));\r\n\t}\r\n\r\n\tfunction handleLogin(email, password) {\r\n\t\treturn auth\r\n\t\t\t.authorize(email, password)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tif (data.token) {\r\n\t\t\t\t\tsetIsLogged(true);\r\n\t\t\t\t\tlocalStorage.setItem('token', data.token);\r\n\t\t\t\t} else if (data.status === 400) {\r\n\t\t\t\t\tthrow new Error('не передано одно из полей');\r\n\t\t\t\t} else if (data.status === 401) {\r\n\t\t\t\t\tthrow new Error('пользователь с email не найден');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('что-то пошло не так');\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.log(err));\r\n\t}\r\n\r\n\tfunction handleSignOut(){\r\n\t\tlocalStorage.removeItem('token');\r\n\t\thistory.push('/sign-in');\r\n\t\tsetIsLogged(false);\r\n\t}\r\n\r\n\tconst closeInfoTooltipSuccess = () => {\r\n\t\tsetShowInfoTooltip(false);\r\n\t\thistory.push('/sign-in');\r\n\t};\r\n\r\n\tconst closeInfoTooltipFailure = () => {\r\n\t\tsetShowInfoTooltip(false);\r\n\t};\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={currentUser}>\r\n\t\t\t<div className=\"page__content\">\r\n\t\t\t\t<div className=\"page\">\r\n\t\t\t\t\t<Header \r\n\t\t\t\t\t\tisLoggedIn={isLoggedIn}\r\n\t\t\t\t\t\tsetLogged={setIsLogged}\r\n\t\t\t\t\t\tonSignOut={handleSignOut}\r\n\t\t\t\t\t\tuserInfo={userInfo}\r\n\t\t\t\t\t\tsetUserInfo={setUserInfo}/>\r\n\t\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t\t<Route path='/sign-up'>\r\n\t\t\t\t\t\t\t\t<Register onRegister={handleRegister}/>\r\n\t\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t\t<Route path='/sign-in'>\r\n\t\t\t\t\t\t\t\t<Login  onLogin ={handleLogin} tokenCheck={tokenCheck} />\r\n\t\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t\t<ProtectedRoute\r\n\t\t\t\t\t\t\t\texact path=\"/\"\r\n\t\t\t\t\t\t\t\tisLoggedIn={isLoggedIn}\r\n\t\t\t\t\t\t\t\tcomponent={Main}\r\n\t\t\t\t\t\t\t\tonEditAvatar={handleEditAvatarClick}\r\n\t\t\t\t\t\t\t\tonEditProfile={handleEditProfileClick}\r\n\t\t\t\t\t\t\t\tonAddPlace={handleAddPlaceClick}\r\n\t\t\t\t\t\t\t\tonCardClick={handleCardClick}\r\n\t\t\t\t\t\t\t\tcards={cards}\r\n\t\t\t\t\t\t\t\tonCardDelete={handleCardDelete}\r\n\t\t\t\t\t\t\t\tonCardLike={handleCardLike}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</ProtectedRoute>\r\n\t\t\t\t\t\t\t<Route>{isLoggedIn ? <Redirect to='/' /> : <Redirect to='/sign-in' />}</Route>\r\n\t\t\t\t\t\t</Switch>\r\n\r\n\t\t\t\t\t<Footer/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<EditProfilePopup\r\n\t\t\t\t\tisOpen={isEditProfilePopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdateUser={handleUpdateUser}\r\n\t\t\t\t/>\r\n\t\t\t\t<EditAvatarPopup\r\n\t\t\t\t\tisOpen={isEditAvatarPopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdateAvatar={handleUpdateAvatar}\r\n\t\t\t\t/>\r\n\t\t\t\t<AddPlacePopup\r\n\t\t\t\t\tisOpen={isAddPlacePopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdatePlace={handleAddPlace}\r\n\t\t\t\t/>\r\n\t\t\t\t<PopupWithForm name='popup-confirm'\r\n\t\t\t\t\ttitle='Вы уверены?'\r\n\t\t\t\t\tbuttonText='Да'\r\n\t\t\t\t\tisOpen={false}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t/>\r\n\t\t\t\t<ImagePopup isOpen={isImagePopupOpen} card={selectedCard} closeIt={handleCloseAll}/>\r\n\t\t\t\t{showInfoTooltip && (\r\n\t\t\t\t\t<InfoTooltip\r\n\t\t\t\t\t\tonClose={registerIsOk ? closeInfoTooltipSuccess : closeInfoTooltipFailure}\r\n\t\t\t\t\t\tisOk={registerIsOk}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</CurrentUserContext.Provider>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}