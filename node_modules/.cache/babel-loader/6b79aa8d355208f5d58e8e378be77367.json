{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\SidWonder\\\\Documents\\\\auth\\\\src\\\\components\\\\App.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport { Route, Switch, Redirect, BrowserRouter, useHistory } from 'react-router-dom';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport Footer from './Footer.js';\nimport PopupWithForm from './PopupWithForm';\nimport EditProfilePopup from './EditProfilePopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport ImagePopup from './ImagePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport api from '../utils/api';\nimport * as auth from '../utils/auth';\nimport Register from './Register';\nimport Login from './Login';\nimport InfoTooltip from './InfoTooltip';\nimport ProtectedRoute from './ProtectedRoute';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [isEditAvatarPopupOpen, setIsAvatarPopupOpen] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsPopupProfileState] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [isLoggedIn, setIsLogged] = React.useState(Boolean(localStorage.getItem('token')));\n  const [userInfo, setUserInfo] = React.useState({});\n  const [registerIsOk, setRegisterIsOk] = React.useState(false);\n  const [showInfoTooltip, setShowInfoTooltip] = React.useState(false);\n  const history = useHistory();\n  React.useEffect(() => {\n    async function fetchData() {\n      const userInfo = await api.getUserInfo();\n      return userInfo;\n    }\n\n    fetchData().then(data => setCurrentUser(data)).catch(err => console.log(err));\n  }, []);\n  React.useEffect(() => {\n    async function fetchData() {\n      const cardsData = await api.getCards();\n      return cardsData;\n    }\n\n    fetchData().then(data => setCards(data)).catch(err => console.log(err));\n  }, []);\n\n  function tokenCheck() {\n    const token = localStorage.getItem('token');\n\n    if (!token) {\n      return;\n    }\n\n    auth.getUserData(token).then(res => {\n      if (res.status === 401) {\n        throw new Error('Токен не передан или передан не в том формате');\n      } else if (res.status === 400) {\n        throw new Error('Переданный токен некорректен');\n      } else {\n        return res.json();\n      }\n    }).then(res => {\n      const data = res.data ? res.data : {};\n      setUserInfo(data);\n    });\n  }\n\n  React.useEffect(() => {\n    tokenCheck();\n\n    if (isLoggedIn) {\n      history.push('/');\n    }\n  }, [isLoggedIn]);\n\n  function handleEditAvatarClick() {\n    setIsAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsPopupProfileState(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);\n  }\n\n  function handleCloseAll() {\n    setIsPopupProfileState(false);\n    setIsAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard({});\n  }\n\n  function handleUpdateUser(userData) {\n    api.setUserInfo(userData).then(data => {\n      setCurrentUser(data);\n    }).catch(err => {\n      console.log(err);\n    });\n    handleCloseAll();\n  }\n\n  function handleUpdateAvatar(userData) {\n    api.setUserAvatar(userData).then(data => {\n      setCurrentUser(data);\n    }).catch(err => {\n      console.log(err);\n    });\n    handleCloseAll();\n  }\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    if (!isLiked) {\n      api.addLike(card).then(newCard => {\n        setCards(state => state.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => {\n        console.log(err);\n      });\n    } else {\n      api.deleteLike(card).then(newCard => {\n        setCards(state => state.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card).then(() => {\n      setCards(cards.filter(item => item._id !== card._id));\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  function handleAddPlace(placeData) {\n    api.addNewCard(placeData).then(data => {\n      setCards([data, ...cards]);\n    }).catch(err => {\n      console.log(err);\n    });\n    handleCloseAll();\n  }\n\n  function handleRegister(email, password) {\n    auth.register(email, password).then(res => {\n      if (res.status === 400) {\n        setRegisterIsOk(false);\n        setShowInfoTooltip(true);\n        throw new Error('некорректно заполнено одно из полей');\n      } else {\n        setRegisterIsOk(true);\n        setShowInfoTooltip(true);\n      }\n    }).catch(e => console.log(e));\n  }\n\n  function handleLogin(email, password) {\n    return auth.authorize(email, password).then(data => {\n      if (data.token) {\n        setIsLogged(true);\n        localStorage.setItem('token', data.token);\n      } else if (data.status === 400) {\n        throw new Error('не передано одно из полей');\n      } else if (data.status === 401) {\n        throw new Error('пользователь с email не найден');\n      } else {\n        throw new Error('что-то пошло не так');\n      }\n    }).catch(e => console.log(e));\n  }\n\n  function handleSignOut() {\n    localStorage.removeItem('token');\n    history.push('/sign-in');\n    setIsLogged(false);\n  }\n\n  const closeInfoTooltipSuccess = () => {\n    setShowInfoTooltip(false);\n    history.push('/sign-in');\n  };\n\n  const closeInfoTooltipFailure = () => {\n    setShowInfoTooltip(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page__content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page\",\n        children: [/*#__PURE__*/_jsxDEV(Header, {\n          isLoggedIn: isLoggedIn,\n          setLogged: setIsLogged,\n          onSignOut: handleSignOut,\n          userInfo: userInfo,\n          setUserInfo: setUserInfo\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-up\",\n            children: /*#__PURE__*/_jsxDEV(Register, {\n              onRegister: handleRegister\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 210,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-in\",\n            children: /*#__PURE__*/_jsxDEV(Login, {\n              onLogin: handleLogin,\n              tokenCheck: tokenCheck\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 213,\n              columnNumber: 9\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n            path: \"/\",\n            isLoggedIn: isLoggedIn,\n            component: Main,\n            onEditAvatar: handleEditAvatarClick,\n            onEditProfile: handleEditProfileClick,\n            onAddPlace: handleAddPlaceClick,\n            onCardClick: handleCardClick,\n            cards: cards,\n            onCardDelete: handleCardDelete,\n            onCardLike: handleCardLike\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            children: isLoggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 29\n            }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/sign-in\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 51\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        closeIt: handleCloseAll,\n        onUpdateUser: handleUpdateUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        closeIt: handleCloseAll,\n        onUpdateAvatar: handleUpdateAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        closeIt: handleCloseAll,\n        onUpdatePlace: handleAddPlace\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(PopupWithForm, {\n        name: \"popup-confirm\",\n        title: \"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",\n        buttonText: \"\\u0414\\u0430\",\n        isOpen: false,\n        closeIt: handleCloseAll\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 5\n      }, this), selectedCard._id && /*#__PURE__*/_jsxDEV(ImagePopup, {\n        isOpen: false,\n        card: selectedCard,\n        closeIt: handleCloseAll\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 26\n      }, this), showInfoTooltip && /*#__PURE__*/_jsxDEV(InfoTooltip, {\n        onClose: registerIsOk ? closeInfoTooltipSuccess : closeInfoTooltipFailure,\n        isOk: registerIsOk\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 199,\n    columnNumber: 3\n  }, this);\n}\n\n_s(App, \"GeJEg5sr80j0rK0zF8RyqWLL6RQ=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["C:/Users/SidWonder/Documents/auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","BrowserRouter","useHistory","Header","Main","Footer","PopupWithForm","EditProfilePopup","AddPlacePopup","ImagePopup","EditAvatarPopup","CurrentUserContext","api","auth","Register","Login","InfoTooltip","ProtectedRoute","App","isEditAvatarPopupOpen","setIsAvatarPopupOpen","useState","isEditProfilePopupOpen","setIsPopupProfileState","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isLoggedIn","setIsLogged","Boolean","localStorage","getItem","userInfo","setUserInfo","registerIsOk","setRegisterIsOk","showInfoTooltip","setShowInfoTooltip","history","useEffect","fetchData","getUserInfo","then","data","catch","err","console","log","cardsData","getCards","tokenCheck","token","getUserData","res","status","Error","json","push","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleCloseAll","handleUpdateUser","userData","handleUpdateAvatar","setUserAvatar","handleCardLike","isLiked","likes","some","i","_id","addLike","newCard","state","map","c","deleteLike","handleCardDelete","deleteCard","filter","item","handleAddPlace","placeData","addNewCard","handleRegister","email","password","register","e","handleLogin","authorize","setItem","handleSignOut","removeItem","closeInfoTooltipSuccess","closeInfoTooltipFailure"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Route, Switch, Redirect, BrowserRouter, useHistory} from 'react-router-dom';\r\nimport Header from './Header.js';\r\nimport Main from './Main.js';\r\nimport Footer from './Footer.js';\r\nimport PopupWithForm from './PopupWithForm';\r\nimport EditProfilePopup from './EditProfilePopup';\r\nimport AddPlacePopup from './AddPlacePopup';\r\nimport ImagePopup from './ImagePopup';\r\nimport EditAvatarPopup from './EditAvatarPopup';\r\nimport {CurrentUserContext} from '../contexts/CurrentUserContext';\r\nimport api from '../utils/api';\r\nimport * as auth from '../utils/auth';\r\nimport Register from './Register';\r\nimport Login from './Login';\r\nimport InfoTooltip from './InfoTooltip';\r\nimport ProtectedRoute from './ProtectedRoute';\r\n\r\nfunction App() {\r\n\r\n\tconst [isEditAvatarPopupOpen, setIsAvatarPopupOpen] = React.useState(false);\r\n\tconst [isEditProfilePopupOpen, setIsPopupProfileState] = React.useState(false);\r\n\tconst [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\r\n\tconst [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\r\n\tconst [selectedCard, setSelectedCard] = React.useState({});\r\n\r\n\tconst [currentUser, setCurrentUser] = React.useState({});\r\n\tconst [cards, setCards] = React.useState([]);\r\n\r\n\tconst [isLoggedIn, setIsLogged] = React.useState(Boolean(localStorage.getItem('token')));\r\n\tconst [userInfo, setUserInfo] = React.useState({});\r\n\tconst [registerIsOk, setRegisterIsOk] = React.useState(false);\r\n\tconst [showInfoTooltip, setShowInfoTooltip] = React.useState(false);\r\n\r\n\tconst history = useHistory();\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function fetchData() {\r\n\t\t\tconst userInfo = await api.getUserInfo();\r\n\t\t\treturn userInfo;\r\n\t\t}\r\n\t\tfetchData()\r\n\t\t\t.then(data=> setCurrentUser(data))\r\n\t\t\t.catch(err => console.log(err));\r\n\t}, []);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tasync function fetchData() {\r\n\t\t\tconst cardsData = await api.getCards();\r\n\t\t\treturn cardsData;\r\n\t\t}\r\n\t\tfetchData()\r\n\t\t\t.then(data=> setCards(data))\r\n\t\t\t.catch(err => console.log(err));\r\n\t}, []);\r\n\r\n\tfunction tokenCheck() {\r\n\t\tconst token = localStorage.getItem('token');\r\n\t\tif (!token) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tauth.getUserData(token)\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res.status === 401) {\r\n\t\t\t\t\tthrow new Error('Токен не передан или передан не в том формате');\r\n\t\t\t\t} else if (res.status === 400) {\r\n\t\t\t\t\tthrow new Error('Переданный токен некорректен');\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn res.json();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tconst data = res.data ? res.data : {};\r\n\t\t\t\tsetUserInfo(data);\r\n\t\t\t});\r\n\t}\r\n\r\n\tReact.useEffect(() => {\r\n\t\ttokenCheck();\r\n\t\tif (isLoggedIn) {\r\n\t\t\thistory.push('/');\r\n\t\t}\r\n\t}, [isLoggedIn]);\r\n\r\n\tfunction handleEditAvatarClick() {\r\n\t\tsetIsAvatarPopupOpen(true);\r\n\t}\r\n\r\n\tfunction handleEditProfileClick() {\r\n\t\tsetIsPopupProfileState(true);\r\n\t}\r\n\r\n\tfunction handleAddPlaceClick() {\r\n\t\tsetIsAddPlacePopupOpen(true);\r\n\t}\r\n\r\n\tfunction handleCardClick(card) {\r\n\t\tsetSelectedCard(card);\r\n\t\tsetIsImagePopupOpen(true);\r\n\t}\r\n\r\n\tfunction handleCloseAll() {\r\n\t\tsetIsPopupProfileState(false);\r\n\t\tsetIsAvatarPopupOpen(false);\r\n\t\tsetIsAddPlacePopupOpen(false);\r\n\t\tsetSelectedCard({});\r\n\t}\r\n\r\n\tfunction handleUpdateUser(userData) {\r\n\t\tapi.setUserInfo(userData).then((data) => {\r\n\t\t\tsetCurrentUser(data);\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t\thandleCloseAll();\r\n\t}\r\n\r\n\tfunction handleUpdateAvatar(userData) {\r\n\t\tapi.setUserAvatar(userData).then((data) => {\r\n\t\t\tsetCurrentUser(data);\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t\thandleCloseAll();\r\n\t}\r\n\r\n\r\n\tfunction handleCardLike(card) {\r\n\t\t// Снова проверяем, есть ли уже лайк на этой карточке\r\n\t\tconst isLiked = card.likes.some(i => i._id === currentUser._id);\r\n\t\tif (!isLiked) {\r\n\t\t\tapi.addLike(card).then((newCard) => {\r\n\t\t\t\tsetCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n\t\t\t}).catch((err) => { console.log(err); });\r\n\t\t} else {\r\n\t\t\tapi.deleteLike(card).then((newCard) => {\r\n\t\t\t\tsetCards((state) => state.map((c) => c._id === card._id ? newCard : c));\r\n\t\t\t}).catch((err) => { console.log(err); });\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleCardDelete(card) {\r\n\t\tapi.deleteCard(card).then(() => {\r\n\t\t\tsetCards(cards.filter((item) => item._id !== card._id));\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t}\r\n\r\n\tfunction handleAddPlace(placeData) {\r\n\t\tapi.addNewCard(placeData).then((data) => {\r\n\t\t\tsetCards([data, ...cards]);\r\n\t\t}).catch((err) => { console.log(err); });\r\n\t\thandleCloseAll();\r\n\t}\r\n\r\n\tfunction handleRegister(email, password) {\r\n\t\tauth.register(email, password)\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res.status === 400) {\r\n\t\t\t\t\tsetRegisterIsOk(false);\r\n\t\t\t\t\tsetShowInfoTooltip(true);\r\n\t\t\t\t\tthrow new Error('некорректно заполнено одно из полей');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetRegisterIsOk(true);\r\n\t\t\t\t\tsetShowInfoTooltip(true);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch((e) => console.log(e));\r\n\t}\r\n\r\n\tfunction handleLogin(email, password) {\r\n\t\treturn auth\r\n\t\t\t.authorize(email, password)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tif (data.token) {\r\n\t\t\t\t\tsetIsLogged(true);\r\n\t\t\t\t\tlocalStorage.setItem('token', data.token);\r\n\t\t\t\t} else if (data.status === 400) {\r\n\t\t\t\t\tthrow new Error('не передано одно из полей');\r\n\t\t\t\t} else if (data.status === 401) {\r\n\t\t\t\t\tthrow new Error('пользователь с email не найден');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('что-то пошло не так');\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch((e) => console.log(e));\r\n\t}\r\n\r\n\tfunction handleSignOut(){\r\n\t\tlocalStorage.removeItem('token');\r\n\t\thistory.push('/sign-in');\r\n\t\tsetIsLogged(false);\r\n\t}\r\n\r\n\tconst closeInfoTooltipSuccess = () => {\r\n\t\tsetShowInfoTooltip(false);\r\n\t\thistory.push('/sign-in');\r\n\t};\r\n\r\n\tconst closeInfoTooltipFailure = () => {\r\n\t\tsetShowInfoTooltip(false);\r\n\t};\r\n\treturn (\r\n\t\t<CurrentUserContext.Provider value={currentUser}>\r\n\t\t\t<div className=\"page__content\">\r\n\t\t\t\t<div className=\"page\">\r\n\t\t\t\t\t<Header \r\n\t\t\t\t\t\tisLoggedIn={isLoggedIn}\r\n\t\t\t\t\t\tsetLogged={setIsLogged}\r\n\t\t\t\t\t\tonSignOut={handleSignOut}\r\n\t\t\t\t\t\tuserInfo={userInfo}\r\n\t\t\t\t\t\tsetUserInfo={setUserInfo}/>\r\n\t\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t\t<Route path='/sign-up'>\r\n\t\t\t\t\t\t\t\t<Register onRegister={handleRegister}/>\r\n\t\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t\t<Route path='/sign-in'>\r\n\t\t\t\t\t\t\t\t<Login  onLogin ={handleLogin} tokenCheck={tokenCheck} />\r\n\t\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t\t\t<ProtectedRoute\r\n\t\t\t\t\t\t\t\tpath=\"/\"\r\n\t\t\t\t\t\t\t\tisLoggedIn={isLoggedIn}\r\n\t\t\t\t\t\t\t\tcomponent={Main}\r\n\t\t\t\t\t\t\t\tonEditAvatar={handleEditAvatarClick}\r\n\t\t\t\t\t\t\t\tonEditProfile={handleEditProfileClick}\r\n\t\t\t\t\t\t\t\tonAddPlace={handleAddPlaceClick}\r\n\t\t\t\t\t\t\t\tonCardClick={handleCardClick}\r\n\t\t\t\t\t\t\t\tcards={cards}\r\n\t\t\t\t\t\t\t\tonCardDelete={handleCardDelete}\r\n\t\t\t\t\t\t\t\tonCardLike={handleCardLike}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</ProtectedRoute>\r\n\t\t\t\t\t\t\t<Route>{isLoggedIn ? <Redirect to='/' /> : <Redirect to='/sign-in' />}</Route>\r\n\t\t\t\t\t\t</Switch>\r\n\r\n\t\t\t\t\t<Footer/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<EditProfilePopup\r\n\t\t\t\t\tisOpen={isEditProfilePopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdateUser={handleUpdateUser}\r\n\t\t\t\t/>\r\n\t\t\t\t<EditAvatarPopup\r\n\t\t\t\t\tisOpen={isEditAvatarPopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdateAvatar={handleUpdateAvatar}\r\n\t\t\t\t/>\r\n\t\t\t\t<AddPlacePopup\r\n\t\t\t\t\tisOpen={isAddPlacePopupOpen}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t\tonUpdatePlace={handleAddPlace}\r\n\t\t\t\t/>\r\n\t\t\t\t<PopupWithForm name='popup-confirm'\r\n\t\t\t\t\ttitle='Вы уверены?'\r\n\t\t\t\t\tbuttonText='Да'\r\n\t\t\t\t\tisOpen={false}\r\n\t\t\t\t\tcloseIt={handleCloseAll}\r\n\t\t\t\t/>\r\n\t\t\t\t{selectedCard._id && <ImagePopup isOpen={false} card={selectedCard} closeIt={handleCloseAll}/>}\r\n\t\t\t\t{showInfoTooltip && (\r\n\t\t\t\t\t<InfoTooltip\r\n\t\t\t\t\t\tonClose={registerIsOk ? closeInfoTooltipSuccess : closeInfoTooltipFailure}\r\n\t\t\t\t\t\tisOk={registerIsOk}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</CurrentUserContext.Provider>\r\n\t);\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}